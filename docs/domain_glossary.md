# Domain Glossar (Arbeitsstand)

| Kanonname               | Aliasse / aktuelle Felder                                                                                                                     | Vorkommen (Auswahl)                                                                                                              | Hinweise                                                                                                  |
|-------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| `site.building_type`    | Precheck-Feld `building_type`, Formularfeld `building_type`, Template-ID `#building_type`, PricingInput `building_type`                        | `apps/quotes/models.py:87`, `apps/customers/models.py:55`, `apps/quotes/forms.py:73`, `templates/quotes/precheck_wizard.html:129` | Nur der Site-Wert flieÃŸt aktuell in die Preislogik (`apps/quotes/pricing.py:272`). Precheck-Duplikat prÃ¼fen. |
| `site.address`          | Formular `customer_address`, Hidden-Field `site_address`, PricingInput `site_address`                                                         | `apps/quotes/forms.py:68`, `templates/quotes/precheck_wizard.html:654`, `apps/quotes/pricing.py:69`                               | Hidden-Feld ist nur Workaround; Ziel: direkt Site-Adresse speichern.                                      |
| `distance_meter`        | `distance_meter_to_inverter`, `distance_meter_to_hak` (legacy), PricingInput `distance_meter`                                                  | `apps/quotes/forms.py:157/336`, `apps/customers/models.py:63`, `apps/quotes/pricing.py:72/256`                                   | Einheitlicher Name nÃ¶tig, damit Fallbacks entfallen.                                                      |
| `wallbox.has_wallbox`   | Precheck `wallbox`, Formular/Template `has_wallbox`, PricingInput `has_wallbox`                                                               | `apps/quotes/models.py:218`, `apps/quotes/forms.py:237`, `templates/quotes/precheck_wizard.html:407`, `apps/quotes/pricing.py:76`| Kanonisch bool `has_wallbox`.                                                                             |
| `wallbox.power`         | `wallbox_class` (Model), `wallbox_power` (Form/Template/API)                                                                                  | `apps/quotes/models.py:221`, `apps/quotes/forms.py:242`, `templates/quotes/precheck_wizard.html:414`, `apps/quotes/pricing.py:281`| Einheitliche Choice-Werte via TextChoices.                                                                |
| `wallbox.mount`         | `wallbox_mount` (Form/Model), Template `#wallbox_mount`                                                                                       | `apps/quotes/models.py:228`, `templates/quotes/precheck_wizard.html:425`                                                         | Passt bereits, nur Choice-Definitionen zentralisieren.                                                    |
| `wallbox.cable.prepared`| `wallbox_cable_prepared` (Model), `wallbox_cable_installed` (Form/Template)                                                                   | `apps/quotes/models.py:235`, `apps/quotes/forms.py:259`, `templates/quotes/precheck_wizard.html:441`                             | Einheitlichen Namen + bool an allen Ebenen angleichen.                                                    |
| `wallbox.cable.length_m`| `wallbox_cable_length_m` (Model), `wallbox_cable_length` (Form/Template/API)                                                                  | `apps/quotes/models.py:239`, `apps/quotes/forms.py:264`, `templates/quotes/precheck_wizard.html:446`, `apps/quotes/pricing.py:285`| Immer Meter; Mapping dokumentieren.                                                                       |
| `wallbox.pv_surplus`    | identisch, aber UI/Model mischen Texte                                                                                                        | `apps/quotes/models.py:265`, `templates/quotes/precheck_wizard.html:435`, `apps/quotes/pricing.py:287`                           | Wert `bool`, spÃ¤ter evtl. eigenes Enum.                                                                   |
| `site.grid_type`        | Formularfeld `grid_type`, PricingInput `grid_type`                                                                                            | `apps/customers/models.py:59`, `apps/quotes/forms.py:125`, `apps/quotes/pricing.py:71/259`                                       | Wird konsistent genutzt, Choice-Definition zentralisieren.                                               |

> ErgÃ¤nzen bei Bedarf weitere Felder/Module. Ziel ist ein gemeinsamer Kanon, auf den wir bei Refactors verweisen kÃ¶nnen.

## PricingInput Mapping (Wizard/API â†’ Kanon)

| Kanon-Feld                   | Aktuelle Aliasse / Quellen                                                                                                 | Hinweise                                                                                                  |
|-----------------------------|------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------|
| `building_type`             | Request `building_type`, Form `building_type`, `Precheck.building_type`, `Site.building_type`                               | Pricing nutzt derzeit `site.building_type`; Doppelhaltung zwischen Site & Precheck Ã¼berprÃ¼fen.            |
| `site_address`              | Hidden Feld `site_address`, `customer_address`/`Site.address`, PricingInput `site_address`                                   | Gleiches Feld mehrfach benannt; Ziel ist direkte Ãœbergabe von `Site.address`.                            |
| `main_fuse_ampere`          | Request/Form `main_fuse_ampere`, `Site.main_fuse_ampere`                                                                     | Wird als int an PricingInput Ã¼bergeben.                                                                   |
| `grid_type`                 | Request/Form `grid_type`, `Site.grid_type`, Choices via `GridType`                                                           | Pricing normalisiert zu lowercase; sollte direkt `GridType`-Werte bekommen.                               |
| `distance_meter`            | Request `distance_meter_to_inverter` (primÃ¤r) oder `distance_meter_to_hak` (Fallback), `Precheck.distance_meter_to_inverter`, `Site.distance_meter_to_hak` | Ein gemeinsamer Feldname wÃ¼rde Fallbacks Ã¼berflÃ¼ssig machen.                                             |
| `desired_power_kw`          | Request/Form `desired_power_kw`, `Precheck.desired_power_kw`                                                                 | Decimal.                                                                                                  |
| `storage_kwh`               | Request/Form `storage_kwh`, `Precheck.storage_kwh`                                                                           | Decimal; `None` â†’ `0`.                                                                                    |
| `own_components`            | Request/Form `own_components`, `Precheck.own_components`                                                                     | Bool; PricingInput nutzt `_as_bool`.                                                                      |
| `wallbox.has_wallbox`       | Request/Form `has_wallbox`, `Precheck.wallbox`                                                                               | Bool; Ã¼berall gleicher Kanonname anstreben.                                                               |
| `wallbox.power`             | Request/Form `wallbox_power`, `Precheck.wallbox_class`                                                                       | Choice per `WallboxClass`; DTO soll nur Kanon akzeptieren.                                                |
| `wallbox.mount`             | Request/Form `wallbox_mount`, `Precheck.wallbox_mount`                                                                       | Bereits konsistent, nur Choice-Quelle zentralisiert.                                                      |
| `wallbox.cable.prepared`    | Request/Form `wallbox_cable_installed`, `Precheck.wallbox_cable_prepared`                                                    | Bool, gleiche Semantik.                                                                                   |
| `wallbox.cable.length_m`    | Request/Form `wallbox_cable_length`, `Precheck.wallbox_cable_length_m`                                                       | Decimal (Meter).                                                                                          |
| `wallbox.pv_surplus`        | Request/Form `wallbox_pv_surplus`, `Precheck.wallbox_pv_surplus`                                                             | Bool.                                                                                                     |

Diese Tabelle dient als Basis, um im nÃ¤chsten Schritt einen Serializer/Adapter zu bauen, der eingehende Form-/API-Daten in die Kanon-Struktur Ã¼berfÃ¼hrt.

## Frontend/Wizard Konzept (Kanon-Namen nutzen)

Der Preis-Wizard nutzt nun direkt denselben Namensraum wie das Backend:

1. **CANONICAL_FIELD_MAP + buildCanonicalPayload():** Die Helper erzeugen das Payload für /api/pricing/preview/ und legen eine Kopie unter _canonical im LocalStorage ab.
2. **Kein Hidden site_address:** Der Wert wird automatisch aus customer_address abgeleitet; die alte Sync-Funktion ist entfernt.
3. **saveFormData/loadFormData:** Neben den ursprünglichen Formwerten wird das kanonische Payload gespeichert (für Debugging), während loadFormData es bewusst ignoriert.
4. **Ausblick Express-Formular:** Bei Bedarf lässt sich derselbe Helper auch im Express-Template verwenden, sobald dort eine Preis-Preview benötigt wird.

Damit greifen AJAX-Preview, LocalStorage und Backend-Adapter auf dieselben Feldnamen zu.

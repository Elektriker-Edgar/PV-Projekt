<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Angebot {{ quote.quote_number }} - EDGARD Elektro</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
            @bottom-center {
                content: "Seite " counter(page) " von " counter(pages);
                font-size: 10px;
                color: #666;
            }
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 12px;
            line-height: 1.6;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .header {
            text-align: center;
            margin-bottom: 3cm;
            border-bottom: 3px solid #2c5aa0;
            padding-bottom: 1cm;
        }

        .company-logo {
            font-size: 32px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 0.5cm;
            letter-spacing: -0.5px;
        }

        .company-tagline {
            font-size: 14px;
            color: #28a745;
            font-weight: 600;
            margin-bottom: 1cm;
        }

        .quote-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2cm;
            page-break-inside: avoid;
        }

        .customer-info, .quote-details {
            width: 48%;
        }

        .info-box {
            background: #f8f9fa;
            padding: 1cm;
            border-left: 4px solid #2c5aa0;
            margin-bottom: 1cm;
        }

        .info-box h3 {
            margin: 0 0 0.5cm 0;
            color: #2c5aa0;
            font-size: 14px;
            font-weight: bold;
        }

        .info-box p {
            margin: 0.2cm 0;
        }

        .project-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            color: #2c5aa0;
            margin: 2cm 0 1.5cm 0;
            page-break-inside: avoid;
        }

        .items-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5cm 0;
            page-break-inside: avoid;
        }

        .items-table th,
        .items-table td {
            border: 1px solid #ddd;
            padding: 0.4cm;
            text-align: left;
            vertical-align: top;
        }

        .items-table th {
            background: linear-gradient(135deg, #2c5aa0, #1e4080);
            color: white;
            font-weight: bold;
            font-size: 11px;
        }

        .items-table td {
            font-size: 11px;
        }

        .items-table .text-right {
            text-align: right;
        }

        .items-table .text-center {
            text-align: center;
        }

        .total-section {
            margin-top: 1cm;
            text-align: right;
            page-break-inside: avoid;
        }

        .total-table {
            width: 40%;
            margin-left: auto;
            border-collapse: collapse;
        }

        .total-table td {
            padding: 0.3cm 0.5cm;
            border-bottom: 1px solid #eee;
        }

        .total-table .total-row {
            font-weight: bold;
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
            font-size: 14px;
        }

        .services-section {
            margin: 2cm 0;
            page-break-inside: avoid;
        }

        .service-item {
            margin-bottom: 0.8cm;
            padding: 0.5cm;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }

        .service-title {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 0.3cm;
        }

        .service-description {
            color: #666;
        }

        .footer {
            margin-top: 3cm;
            padding-top: 1cm;
            border-top: 2px solid #e0e0e0;
            font-size: 10px;
            color: #666;
            page-break-inside: avoid;
        }

        .footer-section {
            margin-bottom: 0.8cm;
        }

        .footer-title {
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 0.3cm;
        }

        .validity-notice {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 0.5cm;
            margin: 1cm 0;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            color: #856404;
        }

        .contact-section {
            background: #f8f9fa;
            padding: 1cm;
            margin: 1.5cm 0;
            border-radius: 4px;
            text-align: center;
        }

        .contact-title {
            font-size: 16px;
            font-weight: bold;
            color: #2c5aa0;
            margin-bottom: 0.5cm;
        }

        .contact-info {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .contact-item {
            text-align: center;
        }

        .print-date {
            position: absolute;
            top: 0.5cm;
            right: 0;
            font-size: 10px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="print-date">
        Erstellt am: {{ quote.created_at|date:"d.m.Y H:i" }}
    </div>

    <!-- Header -->
    <div class="header">
        <div class="company-logo">EDGARD -- Elektro</div>
        <div class="company-tagline">Steckerfertige PV-Anlagen für Hamburg & Umgebung</div>
    </div>

    <!-- Quote and Customer Info -->
    <div class="quote-info">
        <div class="customer-info">
            <div class="info-box">
                <h3>Kunde</h3>
                <p><strong>{{ customer.name }}</strong></p>
                <p>{{ customer.address|linebreaks }}</p>
                <p>E-Mail: {{ customer.email }}</p>
                <p>Telefon: {{ customer.phone }}</p>
            </div>

            <div class="info-box">
                <h3>Installationsort</h3>
                <p>{{ site.address|linebreaks }}</p>
                <p>Gebäudetyp: {{ site.get_building_type_display }}</p>
                <p>Hauptsicherung: {{ site.main_fuse_ampere }} A</p>
                <p>Netzform: {{ site.grid_type }}</p>
            </div>
        </div>

        <div class="quote-details">
            <div class="info-box">
                <h3>Angebot</h3>
                <p><strong>Angebotsnummer: {{ quote.quote_number }}</strong></p>
                <p>Erstellt am: {{ quote.created_at|date:"d.m.Y" }}</p>
                {% if quote.valid_until %}
                <p>Gültig bis: {{ quote.valid_until|date:"d.m.Y" }}</p>
                {% endif %}
                <p>Status: {{ quote.get_status_display }}</p>
            </div>

            <div class="info-box">
                <h3>PV-Projekt</h3>
                <p>Gewünschte Leistung: {{ quote.precheck.desired_power_kw }} kW</p>
                <p>WR-Leistung: {{ quote.precheck.desired_power_kw }} kW ({{ quote.precheck.inverter_label }})</p>
                {% if quote.precheck.storage_kwh %}
                <p>Speicher: {{ quote.precheck.storage_kwh }} kWh</p>
                {% endif %}
                {% if quote.precheck.own_components %}
                <p><em>Kunde bringt eigene Komponenten mit</em></p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Project Title -->
    <div class="project-title">
        Angebot für steckerfertige PV-Anlage ({{ quote.precheck.desired_power_kw }} kW)
    </div>

    <!-- Items Table -->
    <table class="items-table">
        <thead>
            <tr>
                <th style="width: 50%;">Leistungsbeschreibung</th>
                <th style="width: 10%;" class="text-center">Menge</th>
                <th style="width: 15%;" class="text-right">Einzelpreis</th>
                <th style="width: 15%;" class="text-right">Gesamtpreis</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>
                    <strong>{{ item.text }}</strong>
                    {% if item.component %}
                    <br><small style="color: #666;">{{ item.component.vendor }} {{ item.component.name }}</small>
                    {% endif %}
                </td>
                <td class="text-center">{{ item.quantity|floatformat:0 }}</td>
                <td class="text-right">{{ item.unit_price|floatformat:2 }} €</td>
                <td class="text-right">{{ item.line_total|floatformat:2 }} €</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Total Section -->
    <div class="total-section">
        <table class="total-table">
            <tr>
                <td>Zwischensumme (netto):</td>
                <td class="text-right">{{ quote.subtotal|floatformat:2 }} €</td>
            </tr>
            <tr>
                <td>MwSt. ({{ quote.vat_rate|floatformat:0 }}%):</td>
                <td class="text-right">{{ quote.vat_amount|floatformat:2 }} €</td>
            </tr>
            <tr class="total-row">
                <td><strong>Gesamtsumme (brutto):</strong></td>
                <td class="text-right"><strong>{{ quote.total|floatformat:2 }} €</strong></td>
            </tr>
        </table>
    </div>

    <!-- Validity Notice -->
    <div class="validity-notice">
        {% if quote.valid_until %}
        Dieses Angebot ist gültig bis zum {{ quote.valid_until|date:"d.m.Y" }}
        {% else %}
        Dieses Angebot ist 30 Tage gültig
        {% endif %}
    </div>

    <!-- Services Description -->
    <div class="services-section">
        <h3 style="color: #2c5aa0; margin-bottom: 1cm;">Enthaltene Leistungen</h3>
        
        <div class="service-item">
            <div class="service-title">Zählerplatz-Ertüchtigung</div>
            <div class="service-description">
                Erneuerung/Ergänzung gemäß TAB, Anpassung Verdrahtung, Kennzeichnung, Dokumentation nach aktuellen VDE-Normen.
            </div>
        </div>

        <div class="service-item">
            <div class="service-title">Überspannungsschutz AC</div>
            <div class="service-description">
                Einbau und Koordination mit bestehendem SPD, Prüfung Schleifenimpedanz, Messprotokoll und Dokumentation.
            </div>
        </div>

        <div class="service-item">
            <div class="service-title">Wechselrichter Inbetriebnahme</div>
            <div class="service-description">
                Parametrierung, Netzkonfiguration, Funktionstest, Protokoll und fachgerechte Übergabe an den Kunden.
            </div>
        </div>

        <div class="service-item">
            <div class="service-title">MaStR/Netzbetreiber-Meldung</div>
            <div class="service-description">
                Erfassung Stammdaten, Einreichung Unterlagen, Rückmeldung bis Netzfreigabe beim örtlichen Netzbetreiber.
            </div>
        </div>

        {% if quote.precheck.own_components %}
        <div class="service-item">
            <div class="service-title">Integration Kundengeräte</div>
            <div class="service-description">
                Kompatibilitätsprüfung anhand Datenblatt; Anschluss im definierten Umfang, Haftung auf Anschlussarbeiten beschränkt.
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Contact Section -->
    <div class="contact-section">
        <div class="contact-title">Haben Sie Fragen zu diesem Angebot?</div>
        <div class="contact-info">
            <div class="contact-item">
                <strong>Telefon</strong><br>
                040 - 123 456 789
            </div>
            <div class="contact-item">
                <strong>E-Mail</strong><br>
                info@edgard-elektro.de
            </div>
            <div class="contact-item">
                <strong>Servicezeiten</strong><br>
                Mo-Fr 8:00-18:00 Uhr
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <div class="footer-section">
            <div class="footer-title">Zahlungsbedingungen</div>
            <p>30% Anzahlung bei Auftragserteilung, 60% nach Lieferung der Komponenten, 10% nach Inbetriebnahme und Übergabe. Zahlungsziel: 14 Tage netto.</p>
        </div>

        <div class="footer-section">
            <div class="footer-title">Ausführungsfristen</div>
            <p>Ausführung erfolgt nach Verfügbarkeit der Komponenten, in der Regel 2-4 Wochen nach Auftragserteilung. Genaue Terminabstimmung erfolgt rechtzeitig.</p>
        </div>

        <div class="footer-section">
            <div class="footer-title">Geltungsbereich</div>
            <p>Mechanische Montage der PV-Module ist nicht enthalten. Angebot gilt für das Einsatzgebiet Hamburg und Umkreis ca. 60 km. Preise verstehen sich zzgl. gesetzlicher MwSt.</p>
        </div>

        <div class="footer-section">
            <div class="footer-title">EDGARD -- Elektro</div>
            <p>Mustermann Straße 123 • 20357 Hamburg • Tel: 040-123456789 • E-Mail: info@edgard-elektro.de</p>
            <p>Geschäftsführer: Max Mustermann • Amtsgericht Hamburg HRB 123456 • USt-IdNr.: DE123456789</p>
        </div>
    </div>
</body>
</html>
